<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Einzelschläger Rangliste Viewer</title>
    <script src="https://hgverwaltung.ch/polyfill/v3/polyfill.min.js?features=fetch"></script>
    <script src="https://cdn.jsdelivr.net/npm/list.js@2.3.1/dist/list.min.js"></script>
    <style>
        #hg_ligaSelect,
        #hg_data {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }
        #hg_ligaSelect {
            vertical-align: top;
        }
        #hg_data tbody tr:nth-child(odd) {
            background-color: #ebeff4;
        }
        #hg_data tr {
            text-align: left;
        }
        #hg_data th {
            cursor: default;
        }
        #hg_data td,
        #hg_data th {
            padding-left: 3px;
            padding-right: 10px;
        }
        #hg_data .sort.asc::after {
            content: "\25b2";
        }
        #hg_data .sort.desc::after {
            content: "\25bc";
        }
    </style>
</head>
<body>
    <select id="hg_ligaSelect"></select>
    <table id="hg_data" style="display: none;">
        <thead>
            <tr>
                <th class="sort" data-sort="rang">Rang</th>
                <th class="sort" data-sort="name">Name</th>
                <th class="sort" data-sort="vorname">Vorname</th>
                <th class="sort" data-sort="mannschaft">Mannschaft</th>
                <th class="sort" data-sort="anzahlSpiele">Spiele</th>
                <th class="sort" data-sort="rangpunkte">Rangpunkte</th>
                <th class="sort" data-sort="punkte">Punkte</th>
            </tr>
        </thead>
        <tbody class="hg_list">
            <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
        </tfoot>
    </table>
    <table style="display: none;">
        <tr id="hg_tr_template">
            <td class="rang"></td>
            <td class="name"></td>
            <td class="vorname"></td>
            <td class="mannschaft"></td>
            <td class="anzahlSpiele"></td>
            <td class="rangpunkte"></td>
            <td class="punkte"></td>
        </tr>
    </table>

    <script>
    (function () {
        var ligaSelect = document.getElementById('hg_ligaSelect');
        var hgDataTable = document.getElementById("hg_data");
        hgDataTable.createTFoot();

        var valueNames = ['rang', 'name', 'vorname', 'mannschaft', 'anzahlSpiele', 'rangpunkte', 'punkte'];
        var options = {
            valueNames: valueNames,
            listClass: 'hg_list',
            item: 'hg_tr_template'
        };
        var dataList = new List('hg_data', options);

        function loadLiga() {
            fetch('https://hgverwaltung.ch/api/1/live/meisterschaft/liga')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    ligaSelect.innerHTML = '<option value="">Liga auswählen...</option>';
                    var ligas = [...new Set(data.map(item => item.liga))];
                    ligas.forEach(function(liga) {
                        var option = document.createElement('option');
                        option.value = liga;
                        option.textContent = liga;
                        ligaSelect.appendChild(option);
                    });

                    ligaSelect.addEventListener("change", loadRangliste);
                })
                .catch(function(error) {
                    console.error('Fehler beim Laden der Liga:', error);
                });
        }

        function loadRangliste() {
            var liga = ligaSelect.value;

            if (liga) {
                var url = 'https://hgverwaltung.ch/api/1/live/meisterschaft-rangliste-einzelschlaeger/' + liga;
                fetch(url)
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(results) {
                        showData(results);
                    })
                    .catch(function(error) {
                        console.error('Fehler beim Laden der Rangliste:', error);
                    });
            } else {
                showData([]);
            }
        }

        function showData(results) {
            dataList.clear();
            if (results.length === 0) {
                hgDataTable.style.display = 'none';
                return;
            }
            hgDataTable.style.display = '';
            dataList.add(results);
            dataList.sort('rang', { order: "asc" });
        }

        loadLiga();
    })();
    </script>
</body>
</html>
